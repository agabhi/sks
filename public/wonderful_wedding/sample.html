<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draggable Rectangles with Snapping</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        canvas {
            border: 1px solid #000;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <script>const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      
      let objects = [
          { type: 'rect', x: 50, y: 50, width: 100, height: 100 },
          { type: 'rect', x: 200, y: 200, width: 100, height: 100 }
      ];
      
      // Add random shapes and texts
      for (let i = 0; i < 5; i++) {
          objects.push({
              type: 'rect',
              x: Math.random() * 700,
              y: Math.random() * 500,
              width: 50 + Math.random() * 50,
              height: 50 + Math.random() * 50
          });
      }
      
      for (let i = 0; i < 2; i++) {
          objects.push({
              type: 'text',
              x: Math.random() * 700,
              y: Math.random() * 500,
              text: `Text ${i + 1}`
          });
      }
      
      const snapDistance = 5;
      let isDragging = false;
      let dragIndex = -1;
      let offsetX, offsetY;
      
      function draw() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          objects.forEach(obj => {
              if (obj.type === 'rect') {
                  ctx.strokeRect(obj.x, obj.y, obj.width, obj.height);
              } else if (obj.type === 'text') {
                  ctx.font = '20px Arial';
                  ctx.fillText(obj.text, obj.x, obj.y);
              }
          });
      
          if (isDragging) {
              const obj = objects[dragIndex];
              // Draw snap lines
              objects.forEach((target, index) => {
                  if (index !== dragIndex) {
                      drawSnapLines(obj, target);
                  }
              });
          }
      }
      
      function drawSnapLines(obj, target) {
          if (target.type === 'rect') {
              const objCenterX = obj.x + obj.width / 2;
              const objCenterY = obj.y + obj.height / 2;
              const targetCenterX = target.x + target.width / 2;
              const targetCenterY = target.y + target.height / 2;
      
              // Snap lines for edges
              if (Math.abs(obj.x - (target.x + target.width)) < snapDistance) {
                  drawLine(obj.x, 0, obj.x, canvas.height, 'red');
              }
              if (Math.abs((obj.x + obj.width) - target.x) < snapDistance) {
                  drawLine(obj.x + obj.width, 0, obj.x + obj.width, canvas.height, 'red');
              }
              if (Math.abs(obj.y - (target.y + target.height)) < snapDistance) {
                  drawLine(0, obj.y, canvas.width, obj.y, 'red');
              }
              if (Math.abs((obj.y + obj.height) - target.y) < snapDistance) {
                  drawLine(0, obj.y + obj.height, canvas.width, obj.y + obj.height, 'red');
              }
      
              // Snap lines for centers
              if (Math.abs(objCenterX - targetCenterX) < snapDistance) {
                  drawLine(objCenterX, 0, objCenterX, canvas.height, 'blue');
              }
              if (Math.abs(objCenterY - targetCenterY) < snapDistance) {
                  drawLine(0, objCenterY, canvas.width, objCenterY, 'blue');
              }
          } else if (target.type === 'text') {
              const textWidth = ctx.measureText(target.text).width;
              const textHeight = 20; // Approximate height of the text
              const targetCenterX = target.x + textWidth / 2;
              const targetCenterY = target.y - textHeight / 2;
      
              // Snap lines for centers
              if (Math.abs(obj.x + obj.width / 2 - targetCenterX) < snapDistance) {
                  drawLine(targetCenterX, 0, targetCenterX, canvas.height, 'blue');
              }
              if (Math.abs(obj.y + obj.height / 2 - targetCenterY) < snapDistance) {
                  drawLine(0, targetCenterY, canvas.width, targetCenterY, 'blue');
              }
          }
      }
      
      function drawLine(x1, y1, x2, y2, color) {
          ctx.strokeStyle = color;
          ctx.beginPath();
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
          ctx.stroke();
      }
      
      canvas.addEventListener('mousedown', (e) => {
          const mousePos = getMousePos(canvas, e);
          objects.forEach((obj, index) => {
              if (isInside(mousePos, obj)) {
                  isDragging = true;
                  dragIndex = index;
                  offsetX = mousePos.x - obj.x;
                  offsetY = mousePos.y - obj.y;
              }
          });
      });
      
      canvas.addEventListener('mousemove', (e) => {
          if (isDragging) {
              const mousePos = getMousePos(canvas, e);
              const obj = objects[dragIndex];
              obj.x = mousePos.x - offsetX;
              obj.y = mousePos.y - offsetY;
      
              // Snap to other objects
              objects.forEach((target, index) => {
                  if (index !== dragIndex) {
                      snapToTarget(obj, target);
                  }
              });
              draw();
          }
      });
      
      canvas.addEventListener('mouseup', () => {
          isDragging = false;
          draw();
      });
      
      function getMousePos(canvas, event) {
          const rect = canvas.getBoundingClientRect();
          return {
              x: event.clientX - rect.left,
              y: event.clientY - rect.top
          };
      }
      
      function isInside(pos, obj) {
          if (obj.type === 'rect') {
              return pos.x > obj.x && pos.x < obj.x + obj.width && pos.y > obj.y && pos.y < obj.y + obj.height;
          } else if (obj.type === 'text') {
              const textWidth = ctx.measureText(obj.text).width;
              return pos.x > obj.x && pos.x < obj.x + textWidth && pos.y > obj.y - 20 && pos.y < obj.y;
          }
      }
      
      function snapToTarget(obj, target) {
          if (target.type === 'rect') {
              const objCenterX = obj.x + obj.width / 2;
              const objCenterY = obj.y + obj.height / 2;
              const targetCenterX = target.x + target.width / 2;
              const targetCenterY = target.y + target.height / 2;
      
              // Snap to edges
              if (Math.abs(obj.x - (target.x + target.width)) < snapDistance) {
                  obj.x = target.x + target.width;
              }
              if (Math.abs((obj.x + obj.width) - target.x) < snapDistance) {
                  obj.x = target.x - obj.width;
              }
              if (Math.abs(obj.y - (target.y + target.height)) < snapDistance) {
                  obj.y = target.y + target.height;
              }
              if (Math.abs((obj.y + obj.height) - target.y) < snapDistance) {
                  obj.y = target.y - obj.height;
              }
      
              // Snap to right edges
              if (Math.abs((obj.x + obj.width) - (target.x + target.width)) < snapDistance) {
                  obj.x = target.x + target.width - obj.width;
              }
              if (Math.abs((obj.y + obj.height) - (target.y + target.height)) < snapDistance) {
                  obj.y = target.y + target.height - obj.height;
              }
      
              // Snap to centers
              if (Math.abs(objCenterX - targetCenterX) < snapDistance) {
                  obj.x = targetCenterX - obj.width / 2;
              }
              if (Math.abs(objCenterY - targetCenterY) < snapDistance) {
                  obj.y = targetCenterY - obj.height / 2;
              }
          } else if (target.type === 'text') {
              const textWidth = ctx.measureText(target.text).width;
              const textHeight = 20; // Approximate height of the text
              const targetCenterX = target.x + textWidth / 2;
              const targetCenterY = target.y - textHeight / 2;
      
              // Snap to centers
              if (Math.abs(obj.x + obj.width / 2 - targetCenterX) < snapDistance) {
                  obj.x = targetCenterX - obj.width / 2;
              }
              if (Math.abs(obj.y + obj.height / 2 - targetCenterY) < snapDistance) {
                  obj.y = targetCenterY - obj.height / 2;
              }
          }
      }
      
      draw();
      </script>
</body>
</html>
